name: ğŸ‚ AnymeX Birthday

on:
  # 00 : 00 IST every 6 Aug  â†’  18 : 30 UTC every 5 Aug
  schedule:
    - cron: '30 18 5 8 *'
  workflow_dispatch:

jobs:
  announce:
    runs-on: ubuntu-latest

    steps:
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: Calculate project age
        id: age
        run: |
          BIRTH_YEAR=2024
          CURRENT_YEAR=$(TZ=Asia/Kolkata date +%Y)
          AGE=$(( CURRENT_YEAR - BIRTH_YEAR ))

          if [ "$AGE" -eq 1 ]; then
            AGE_TEXT="${AGE} year old"
          else
            AGE_TEXT="${AGE} years old"
          fi

          echo "age_text=$AGE_TEXT" >> "$GITHUB_OUTPUT"

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: Send Discord embed
        env:
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
        run: |
          AGE_TEXT="${{ steps.age.outputs.age_text }}"
          CONTENT='||@everyone ||'

          DESCRIPTION="[AnymeX](<https://github.com/RyanYuuki/AnymeX/>) is now ${AGE_TEXT} ğŸ¥³\nThe [initial commit](<https://github.com/RyanYuuki/AnymeX/commit/04dff6ede733f93363c0a38368fd3c2ee23a7407>) was done <t:1722882600:R>\n\n[â­ï¸ Star](<https://github.com/RyanYuuki/AnymeX/>) the repo as a birthday gift ğŸ˜š"

          JSON=$(jq -n \
            --arg content "$CONTENT" \
            --arg desc    "$DESCRIPTION" \
            '{
              content: $content,
              embeds: [ { title: "ğŸ‚ AnymeX Anniversary", description: $desc, color: 16711858 } ]
            }')

          curl -X POST -H "Content-Type: application/json" \
               -d "$JSON" \
               "$DISCORD_WEBHOOK_URL"